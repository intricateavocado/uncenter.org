{% set openGraphImage = [
    meta.url, '/assets/previews/', title | slugify,
    '.png'
] | join %}
{% set metaTitle = title + " &middot; " + meta.domain %}

<!DOCTYPE html>
<html lang="{{ meta.lang }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ metaTitle }}</title>

        <script>
            {{ inlined.js.before | safe }}
        </script>

        <link rel="stylesheet" href="/assets/styles.css?v={{ gitRev }}">
        <style>
            {{ inlined.css | safe }}
        </style>
        <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/GeneralSans-Variable.woff2" crossorigin="anonymous">

        <script defer data-website-id="{{ meta.analytics.websiteId }}" data-domains="{{ meta.domain }}" src="{{ meta.analytics.url }}/{{ meta.analytics.trackerScript }}.js"></script>

        <meta name="author" content="{{ meta.author.name }}">
        <meta name="description" content="{% if description %}{{ description }}{% else %}{{ meta.description }}{% endif %}">
        <meta name="generator" content="{{ eleventy.generator }}">
        <meta name="keywords" content="{{ meta.keywords | join(', ') }}">

        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=20230522">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=20230522">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=20230522">
        <link rel="manifest" href="/site.webmanifest?v=20230522">
        <link rel="shortcut icon" href="/favicon.ico?v=20230522">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="theme-color" content="#ffffff">
        <meta name="view-transition" content="same-origin">

        <link href="https://github.com/{{ meta.author.github.username }}" rel="me">
        <link href="https://{{ meta.author.mastodon.instance }}/@{{ meta.author.mastodon.username }}" rel="me">

        <link rel="canonical" href="{{ meta.url }}{{ page.url }}">
        <link rel="alternate" type="application/rss+xml" href="{{ meta.url }}/feed.xml">

        {% if layout != 'post.njk' %}
            <meta property="og:type" content="website">
        {% else %}
            <meta property="og:type" content="article">
            <meta property="og:article:published_time" content="{{ date }}">
            <meta property="og:article:section" content="Technology">
            {% for keyword in tags %}
                <meta property="og:article:tag" content="{{ keyword | capitalize }}">
            {% endfor %}
        {% endif %}
        <meta property="og:title" content="{{ metaTitle }}">
        <meta property="og:description" content="{% if description %}{{ description }}{% else %}{{ meta.description }}{% endif %}">
        <meta property="og:image" content="{{ openGraphImage }}">
        <meta property="og:image:width" content="1200">
        <meta property="og:image:height" content="630">

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ metaTitle }}">
        <meta name="twitter:image" content="{{ openGraphImage }}">
    </head>
    <body class="bg-bg text-fg font-display">
        <header class="max-w-[30ch] mx-auto">
            {% include "components/header.njk" %}
        </header>
        <main class="max-w-[80ch] w-full">
            {{ content | safe }}
        </main>
        <footer class="max-w-[30ch] mx-auto mt-12 lg:mt-4">
            {% include "components/footer.njk" %}
        </footer>
    </body>
    <script>
        function loadGiscus() {
            if (!document.querySelector('#comments')) 
                return;
            let giscusAttributes = {
                src: 'https://giscus.app/client.js',
                'data-repo': '{{ meta.author.github.username }}/{{ meta.repo }}',
                'data-repo-id': 'R_kgDOHSjhjQ',
                'data-category-id': 'DIC_kwDOHSjhjc4CTQUr',
                'data-mapping': 'title',
                'data-reactions-enabled': '1',
                'data-emit-metadata': '0',
                'data-input-position': 'top',
                'data-theme': document
                    .documentElement
                    .getAttribute('theme'),
                'data-lang': 'en',
                crossorigin: 'anonymous',
                async: ''
            };
            let giscusScript = document.createElement('script');
            Object
                .entries(giscusAttributes)
                .forEach(([key, value]) => giscusScript.setAttribute(key, value),);
            document
                .querySelector('#comments')
                .innerHTML = '';
            document
                .querySelector('#comments')
                .appendChild(giscusScript);
        }
        {{ inlined.js.after | safe }}
    </script>
</html>